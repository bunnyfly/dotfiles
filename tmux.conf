####################################################################################################
# Tmux Configuration by Chloe Adeline
#
# A Vim-like Tmux experience! I use the Colemak keyboard layout; places where my own Colemak-Vim
# bindings are used mention "Colemak" in the comments. [I use HNEI arrows instead of HJKL, K instead
# of N for searching, etc.]
####################################################################################################


####################################################################################################
# GENERAL OPTIONS
####################################################################################################
set -g history-limit 10000
set -g default-terminal "screen-256color"
set -g escape-time 0 
set -g default-path "~"
set -g base-index 1  # Start window numbering at 1.

# Vi-Mode!
set -g status-keys vi
setw -g mode-keys vi

# Powerline status bar. Only sources if file exists.
if-shell "test -f /usr/local/google/home/chloeadeline/.vim/bundle/powerline/powerline/bindings/tmux/powerline.conf" \
    "source '/usr/local/google/home/chloeadeline/.vim/bundle/powerline/powerline/bindings/tmux/powerline.conf'"
if-shell "test -f /Users/Bunnyfly/dotfiles/vim/bundle/powerline/powerline/bindings/tmux/powerline.conf" \
    "source '/Users/Bunnyfly/dotfiles/vim/bundle/powerline/powerline/bindings/tmux/powerline.conf'"


####################################################################################################
# KEY BINDINGS - GENERAL
####################################################################################################

# Ctrl-A prefix.
unbind C-b ; unbind-key l
set -g prefix C-a
set -g prefix2 C-A

# ; command prompt.
unbind-key :
bind-key \; command-prompt

# Misc
unbind-key ]
bind-key p paste-buffer
bind-key R refresh-client

# Unused bindings.
unbind-key q # display-panes
unbind-key t # clock-mode
unbind-key u # select-layout -u
unbind-key '~' # show-messages


####################################################################################################
# KEY BINDINGS - SESSIONS
####################################################################################################

# Last/previous/next session. [Colemak]
unbind-key L ; unbind-key ( ; unbind-key )
bind-key A switch-client -l
bind-key H switch-client -p
bind-key I switch-client -n

bind-key < command-prompt -I "rename-session "
bind-key Enter choose-session


####################################################################################################
# KEY BINDINGS - WINDOWS
####################################################################################################

# Last/previous/next window. [Colemak]
unbind-key n ; unbind-key Tab # ; unbind-key p # already bound to paste-buffer
bind-key C-a last-window
bind-key C-h previous-window
bind-key C-i next-window

bind-key , command-prompt -I "rename-window "
bind-key c new-window
bind-key C set default-path "" \; new-window \; set default-path "~"


####################################################################################################
# KEY BINDINGS - PANES
####################################################################################################

# Last/select pane. [Colemak]
bind-key a last-pane
unbind-key Up ; unbind-key Down ; unbind-key Left ; unbind-key Right
bind-key h select-pane -L
bind-key n select-pane -D
bind-key e select-pane -U
bind-key i select-pane -R

# More Vim-like quit.
unbind-key x # confirm-before -p "Quit pane #P? (y/n)" kill-pane
bind-key q confirm-before -p "Quit pane #P? (y/n)" kill-pane

# Resize panes with arrows.
unbind-key M-Left ; unbind-key M-Down ; unbind-key M-Up ; unbind-key M-Right
bind-key Left resize-pane -L 5
bind-key Down resize-pane -D 5
bind-key Up resize-pane -U 5
bind-key Right resize-pane -R 5

# Split panes.
unbind-key % ; unbind-key '"'
bind-key s split-window -h
bind-key S split-window

unbind-key C-o
bind-key r rotate-window


####################################################################################################
# KEY BINDINGS - VI-COPY MODE
####################################################################################################

# More Vim-like
unbind-key [ # copy-mode
unbind-key Space # begin-selection
unbind-key Enter # copy-selection
bind-key Space copy-mode
bind-key -t vi-copy v begin-selection
bind-key -t vi-copy c-v rectangle-toggle
bind-key -t vi-copy y copy-selection

# Colemak Keys
bind-key -t vi-copy n cursor-down
bind-key -t vi-copy e cursor-up
bind-key -t vi-copy i cursor-right
bind-key -t vi-copy k search-again
bind-key -t vi-copy K search-reverse
bind-key -t vi-copy l start-of-line
bind-key -t vi-copy L end-of-line
bind-key -t vi-copy j next-word-end
bind-key -t vi-copy J next-space-end
bind-key -t vi-copy c-n bottom-line
bind-key -t vi-copy c-m middle-line
bind-key -t vi-copy c-e top-line


####################################################################################################
# KEY BINDINGS - VI-CHOICE MODE
####################################################################################################

# Colemak
unbind-key -t vi-choice j # down
unbind-key -t vi-choice k # up
bind-key -t vi-choice n down
bind-key -t vi-choice e up
#bind-key -t vi-choice h tree-collapse
#bind-key -t vi-choice i tree-expand

bind-key -t vi-choice o choose


####################################################################################################
# KEY BINDINGS - VI-EDIT MODE
####################################################################################################

# Colemak
unbind-key -ct vi-edit j # history-down
unbind-key -ct vi-edit k # history-up
unbind-key -ct vi-edit l # cursor-right
unbind-key -ct vi-edit e # next-word-end
unbind-key -ct vi-edit E # next-space-end
unbind-key -ct vi-edit i # switch-mode
#unbind-key -ct vi-edit I # switch-mode-begin-line
bind-key -ct vi-edit n history-down
bind-key -ct vi-edit e history-up
bind-key -ct vi-edit s switch-mode
#bind-key -ct vi-edit S switch-mode-begin-line
bind-key -ct vi-edit l start-of-line
bind-key -ct vi-edit L end-of-line
bind-key -ct vi-edit j next-word-end
bind-key -ct vi-edit J next-space-end

# TODO: M-i ; M-p


####################################################################################################
# CLEANUP
####################################################################################################

# Unused bindings that weren't unbound.
unbind-key Tab
